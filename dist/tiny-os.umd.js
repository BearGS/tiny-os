!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n["tiny-os"]=n["tiny-os"]||{},n["tiny-os"].umd=n["tiny-os"].umd||{},n["tiny-os"].umd.js={}))}(this,function(n){"use strict";var t={UNREGISTER:"unregister",UNLOAD:"unload",BACKEND:"backend",FRONTEND:"frontend"},e={REGISTER:"register",LOAD:"load",OPEN:"open",SUSPEND:"suspend",KILL:"kill"},r={FORERVER:"forever",TEMPORARY:"temporary"},i=function(){};function o(n,t){for(var e=arguments.length,r=Array(e>2?e-2:0),o=2;o<e;o++)r[o-2]=arguments[o];if(i(t),n){var a=void 0;if(void 0===t)a=new Error("Minified exception occurred use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=0;a=new Error(t.replace(/%s/g,function(){return r[u++]}))}throw a.framesToPop=1,a}}var a=function(){var n=[];return{notify:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return n.forEach(function(n){return n.apply(void 0,e)})},add:function(t){return n.push(t),function(){n=n.filter(function(n){return n!==t})}}}};var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},s=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")},f=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},c="",l=[],h=[];function d(n){var t=h.find(function(t){return t.name===n.name});return o(!t,"No such Iframe named `"+n.name+"`"),t.iframe}var p=new function n(t){var r=this;s(this,n),this.container=window.document.body,this.updateRouterMap=function(n){l=n},this.configContainer=function(n){r.container="string"==typeof n?document.getElementById(n):n},this.goRouter=function(n){var t=n.name,e=n.handler;return r.history.setHash({hash:t,handler:e})},this.render=function(n){var t=n.name,i=void 0===t?"":t,a=n.handler,u=function(n){var t=l.find(function(t){return t.name===n});return o(!t,"No such router named `"+n+"`"),t}(i);switch(a){case e.LOAD:r.loadIframe(u);break;case e.OPEN:d(u).style.display=null;break;case e.SUSPEND:!function(n){n.style.display="none"}(d(u));break;case e.KILL:r.killIframe(u)}},this.loadIframe=function(n){var t=n.name,e=n.url;if(!h.find(function(n){return n.name===t})){var i=function(n,t,e){var r=document.createElement("iframe");return r.setAttribute("id",t),r.setAttribute("src",e),r.setAttribute("sandbox","allow-forms allow-same-origin allow-scripts allow-popups"),r.style.border="none",r.style.display="none",n.appendChild(r),r}(r.container,t,e);h.push({name:t,iframe:i})}},this.killIframe=function(n){var t,e,i,o=n.name;t=r.container,e=o,i=document.getElementById(e),t.removeChild(i),h=h.filter(function(n){return n.name!==o})},this.getCurrentUrl=function(){return c},this.getRouterMap=function(){return l},c=t||window.location.hash||"",this.history=function(n){var t=a(),e=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.path,i=void 0===e?r.location.pathname:e,o=n.state,a=void 0===o?r.state:o,u=n.hash,s=void 0===u?r.location.hash:u,f=n.handler,c=void 0===f?"":f;t.notify({path:i,state:a,hash:s,handler:c})};window.addEventListener("popstate",function(){}),window.addEventListener("hashchange",function(){e()});var r={go:function(t){return n.go(t)},back:function(){return n.go(-1)},forward:function(){return n.go(1)},push:function(t,r,i){n.pushState(r,"",t),e({handler:i})},replace:function(t,r,i){n.replaceState(r,"",t),e({handler:i})},setHash:function(t){var i=t.hash,o=t.handler;r.location.hash!=="#"+i&&(n.pushState(null,null,"#"+i),e({handler:o}))},listen:function(n){return t.add(n)},state:n.state,length:n.length,location:window.location};return r}(window.history)};function v(n,t){return n.priority===r.FORERVER?-1:t.priority===r.FORERVER?1:n.loadTime>t.loadTime?-1:1}var m=[];function g(n){n.state=t.BACKEND,n.loadTime=Date.now()}function y(n){n.state=t.UNLOAD,n.loadTime=0}function A(n){p.updateRouterMap(m),n&&(p.render(n),n.handler===e.OPEN&&p.goRouter(n))}var E=new function n(){var i=this;if(s(this,n),this.register=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.name,e=n.url,a=n.priority,u=void 0===a?r.TEMPORARY:a;o(!t||"string"!=typeof t,"Invalid params name"),o(!e||"string"!=typeof e,"Invalid params url"),o(i.getApp(t,!0),"you've already register another app named `"+t+"`");var s={name:t,url:e,priority:u};m.unshift(s),y(s),A()},this.registerAll=function(n){n.forEach(function(n){return i.register(n)})},this.onOuterAppChange=function(n){var t=n.hash,e=void 0===t?"":t;if(e){var r=e.slice(1),o=i.getApp(r,!0);o?i.launch(o.name):window.location.hash=e}},this.launch=function(n){var t=i.getApp(n);i.suspendOpendApp().load(t).open(t).killOverflowApp()},this.load=function(n){return g(n),m.sort(v),A(f({},n,{handler:e.LOAD})),i},this.open=function(n){return n.state=t.FRONTEND,A(f({},n,{handler:e.OPEN})),i},this.suspend=function(n){return g(n),A(f({},n,{handler:e.SUSPEND})),i},this.kill=function(n){return y(n),A(f({},n,{handler:e.KILL})),i},this.suspendOpendApp=function(){return m.filter(function(n){return n.state===t.FRONTEND}).forEach(function(n){return i.suspend(n)}),i},this.killOverflowApp=function(){var n=m.filter(function(n){return n.state===t.BACKEND});if(n.length>=5){var e=n.pop();i.kill(e)}return i},this.getApps=function(){return m},this.getApp=function(n,t){var e=m.find(function(t){return t.name===n});return o(!t&&!e,"No such App named `"+n+"`"),e},this.getUnloadApps=function(){return m.filter(function(n){return n.state===t.UNLOAD})},this.getBackendApps=function(){return m.filter(function(n){return n.state===t.BACKEND})},this.getFrontendApps=function(){return m.filter(function(n){return n.state===t.FRONTEND})},"object"===u(n.instance)&&n.instance instanceof n)return n.instance;Object.defineProperty(n,"instance",{value:this,configurable:!1,writable:!1}),p.history.listen(this.onOuterAppChange.bind(this))},w={};n.Host=function n(){var t=this;if(s(this,n),this.launchApp=function(n){return E.launch(n)},this.registerApp=function(n){return E.register(n)},this.registerAll=function(n){return E.registerAll(n)},this.configContainer=function(n){return p.configContainer(n)},this.getApps=function(){return E.getApps()},this.use=function(n){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];if(!n.installed)return n.install(t.modules,r),n.installed=!0,t},this.getModules=function(){return w},this.getModule=function(n){return w[n]},"object"===u(n.instance)&&n.instance instanceof n)return n.instance;Object.defineProperty(n,"instance",{value:this,configurable:!1,writable:!1})},Object.defineProperty(n,"__esModule",{value:!0})});
